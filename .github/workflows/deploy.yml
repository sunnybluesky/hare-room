name: Deploy to Raspberry Pi

on:
  push:
    branches: [ main ] # mainブランチにpushされた時に実行

jobs:
  deploy:
    runs-on: self-hosted # ラズパイのRunnerを指定
    steps:
      - name: Pull latest code and Restart PM2
        # ラズパイ上で index.js があるディレクトリの絶対パスを指定してください
        working-directory: /home/share/Github/hare-room 
        run: |
          # 1. リモートの最新情報を取得
          git fetch origin main
          # 2. 現在のブランチをリモートの最新状態に強制リセット（これが確実です）
          git reset --hard origin/main
          # 3. PM2で再起動
          pm2 restart hare-room